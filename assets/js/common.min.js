var vq={};vq.common={submitForm:function(e){var t={id:"",backUrl:"",backInfo:"返回到上一页",rules:{},messages:{},successInfo:"继续添加",ignore:"",beforeSubmit:false,beforeSubmitInfo:"",success:"",fail:""};var n=$.extend({},t,e);var o=$("#"+n.id);o.validate({debug:false,onfocusout:false,onkeyup:false,highlight:false,ignore:n.ignore,onclick:false,showErrors:function(e,t){try{$(t[0].element).focus();art.dialog({id:"error",icon:"error",lock:true,fixed:true,background:"#CCCCCC",opacity:0,content:t[0].message,ok:function(){$(t[0].element).focus()}})}catch(e){}},rules:n.rules,messages:n.messages,submitHandler:function(e){if(n.beforeSubmit){artDialog.confirm(n.beforeSubmitInfo,function(){var a=art.dialog({id:"loading",fixed:true,lock:true,background:"#CCCCCC",opacity:0,esc:false,title:false,cancel:false});$(e).ajaxSubmit({url:o.attr("action"),dataType:"json",success:function(e,t,o,c){a.close();if(e.code==0){if(n.success!=""){n.success(e)}else{if(n.backUrl==""){art.dialog({id:"succeed",icon:"succeed",fixed:true,lock:true,background:"#CCCCCC",opacity:0,content:e.msg,button:[{name:n.successInfo,callback:function(){if(n.successbackUrl){location.href=n.successbackUrl}else{window.location=location.href}return true},focus:true},{name:"关闭"}]})}else{art.dialog({id:"succeed",icon:"succeed",fixed:true,lock:true,background:"#CCCCCC",opacity:0,content:e.msg,button:[{name:n.successInfo,callback:function(){if(n.successbackUrl){location.href=n.successbackUrl}else{window.location=location.href}return true},focus:true},{name:n.backInfo,callback:function(){location.href=n.backUrl;return true}}]})}}}else{if(n.fail!=""){n.fail(e)}else{art.dialog({id:"error",icon:"error",fixed:true,lock:true,background:"#CCCCCC",opacity:0,content:e.msg,cancel:true})}}},error:function(){a.close();vq.common.error({content:vq_lan.common.system_error})}})})}else{var a=art.dialog({id:"loading",fixed:true,lock:true,background:"#CCCCCC",opacity:0,esc:false,title:false,cancel:false});$(e).ajaxSubmit({url:o.attr("action"),dataType:"json",success:function(e,t,o,c){a.close();if(e.code==0){if(n.success!=""){n.success(e)}else{if(n.backUrl==""){art.dialog({id:"succeed",icon:"succeed",fixed:true,lock:true,background:"#CCCCCC",opacity:0,content:e.msg,button:[{name:n.successInfo,callback:function(){if(n.successbackUrl){location.href=n.successbackUrl}else{window.location=location.href}return true},focus:true},{name:"返回"}]})}else{art.dialog({id:"succeed",icon:"succeed",fixed:true,lock:true,background:"#CCCCCC",opacity:0,content:e.msg,button:[{name:n.successInfo,callback:function(){if(n.successbackUrl){location.href=n.successbackUrl}else{window.location=location.href}return true},focus:true},{name:n.backInfo,callback:function(){location.href=n.backUrl;return true}}]})}}}else{if(n.fail!=""){n.fail(e)}else{art.dialog({id:"error",icon:"error",fixed:true,lock:true,background:"#CCCCCC",opacity:0,content:e.msg,cancelVal:"确定",cancel:true})}}},error:function(){a.close();vq.common.error({content:"系统错误，请联系管理员"})}})}}})},getChildCategory:function(n,e,r){var s=art.dialog({id:"loading",fixed:true,lock:true,esc:false,title:false,cancel:false});$.ajax({url:"/index/public_get_child_category",type:"get",dataType:"json",data:{parent_id:e},success:function(e){s.close();if(e.code){var t="";var o="";var c=e.data;for(var a=0;a<c.length;a++){o+='<option value="'+c[a].id+'">'+c[a].name+"</option>"}if(n=="1"){t='<option value="">'+$("#cate_name1"+r).attr("title")+"</option>";$("#cate_name1"+r).empty().append(t+o);$("#cate_name2"+r).empty().append('<option value="">'+$("#cate_name2"+r).attr("title")+"</option>");$("#cate_name3"+r).empty().append('<option value="">'+$("#cate_name3"+r).attr("title")+"</option>")}else if(n=="2"){t='<option value="">'+$("#cate_name2"+r).attr("title")+"</option>";$("#cate_name2"+r).empty().append(t+o);$("#cate_name3"+r).empty().append('<option value="">'+$("#cate_name3"+r).attr("title")+"</option>")}else if(n=="3"){t='<option value="">'+$("#cate_name3"+r).attr("title")+"</option>";$("#cate_name3"+r).empty().append(t+o)}$(".selectpicker").selectpicker("refresh")}else{vq.common.error({content:e.msg})}},error:function(){s.close()}})},success:function(e){var t={content:"",callback:function(){}};var o=$.extend({},t,e);art.dialog({id:"succeed",icon:"succeed",title:"提示",lock:true,fixed:true,cancel:false,background:"#CCCCCC",opacity:0,content:o.content,ok:function(){o.callback()}})},error:function(e){var t={content:"",callback:function(){}};var o=$.extend({},t,e);art.dialog({id:"error",icon:"error",title:"提示",lock:true,cancel:false,fixed:true,background:"#CCCCCC",opacity:0,content:o.content,ok:function(){o.callback()}})},confirm:function(e){var t={content:"",ok:function(){},cancel:function(){}};var o=$.extend({},t,e);art.dialog({id:"confirm",title:"提示",lock:true,fixed:true,opacity:0,content:"<div style='min-width: 100px;text-align: center'>"+o.content+"</div>",ok:function(){o.ok()},cancel:function(){o.cancel()}})},getVersionsByProjectId:function(e,c,a){if(e==0){$("#"+c).empty().append('<option value="0">'+a+"</option>").selectpicker("refresh");return}var n=art.dialog({id:"loading",fixed:true,lock:true,esc:false,title:false,cancel:false});$.ajax({url:"/not_auth/getVersionsByProjectId",type:"get",dataType:"json",data:{project_id:e},success:function(e){n.close();if(e.code==0){var t=e.projectHistories;str='<option value="0">'+a+"</option>";for(var o=0;o<t.length;o++){str+='<option value="'+t[o].version+'">'+t[o].version+"</option>"}$("#"+c).empty().append(str).selectpicker("refresh")}else{vq.common.error({content:e.msg})}},error:function(){n.close()}})},getSpidersAndServersByProjectId:function(e,n,r){if($(e).val()==""){$("#"+n).empty().append(str).selectpicker("refresh");$("#"+r).empty().append(str).selectpicker("refresh")}else{var s=this;this.block();$.ajax({url:"/not_auth/getSpidersAndServersByProjectId",type:"get",dataType:"json",data:{project:$(e).val()},success:function(e){s.unblock();if(e.code==0){var t=e.spiders;var o="";for(var c=0;c<t.length;c++){o+='<option value="'+t[c].id+"|"+t[c].name+'">'+t[c].name+"</option>"}$("#"+n).empty().append(o).selectpicker("refresh");o="";var a=e.servers;for(var c=0;c<a.length;c++){o+='<option value="'+a[c].id+"|"+a[c].host+'">'+a[c].host+"</option>"}$("#"+r).empty().append(o).selectpicker("refresh")}else{vq.common.error({content:e.msg})}},error:function(){s.unblock()}})}},block:function(){KTApp.block($("#kt_content"),{message:"请等待...",opacity:.1})},unblock:function(){KTApp.unblock($("#kt_content"))},get:function(e){var t=$(e),o=t.data("href"),c=t.data("msg"),a=t.data("datatable");if(c==""||c==undefined){c="确定要执行此操作吗？"}var n=this;art.dialog({title:false,content:c,follow:e,close:function(){return true},ok:function(){n.block();$.getJSON(o).done(function(e){n.unblock();if(e.code==0){if(e.url){location.href=e.url}else{if(a=="yes"){datatableObj.reload(false)}else{location.reload()}}}else{art.dialog.alert(e.msg)}})},cancel:true})},updateSchedulesStatus:function(e,t){this.block();var o=this;$.ajax({url:"/task/task/updateSchedulesStatus",type:"post",dataType:"json",data:{id:e,status:t},success:function(e){o.unblock();if(e.code==0){reloadDatatable()}else{vq.common.error({content:e.msg})}},error:function(){o.unblock()}})},stopSelectedTask:function(){var c=this;vq.common.confirm({content:"确定要停止吗?",ok:function(){var e=datatableObj.getSelectedRecords();var t=[];for(var o=0;o<e.length;o++){t.push($(e[o]).find("input[type='checkbox']").val())}if(t.length>0){c.block();$.ajax({url:"/task/task/cancelMulti",type:"post",dataType:"json",data:{ids:JSON.stringify(t)},success:function(e){c.unblock();if(e.code==0){reloadDatatable(false)}else{vq.common.error({content:e.msg})}},error:function(){c.unblock()}})}else{vq.common.error({content:"请选择任务"})}}})},stopAllTask:function(){var a=this;vq.common.confirm({content:"确定要停止吗?",ok:function(){a.block();var e=$("#project_id").val();var t=$("#version").val();var o=$("#server_id").val();var c=$("#task-status .active").attr("data-status");$.ajax({url:"/task/task/cancelAll",type:"post",dataType:"json",data:{project_id:e,version:t,server_id:o,status:c},success:function(e){a.unblock();if(e.code==0){reloadDatatable(false)}else{vq.common.error({content:e.msg})}},error:function(){a.unblock()}})}})},delSelectedTask:function(){var c=this;vq.common.confirm({content:"确定要删除吗?",ok:function(){var e=datatableObj.getSelectedRecords();var t=[];for(var o=0;o<e.length;o++){t.push($(e[o]).find("input[type='checkbox']").val())}if(t.length>0){c.block();$.ajax({url:"/task/task/delMulti",type:"post",dataType:"json",data:{ids:JSON.stringify(t)},success:function(e){c.unblock();if(e.code==0){reloadDatatable(false)}else{vq.common.error({content:e.msg})}},error:function(){c.unblock()}})}else{vq.common.error({content:"请选择任务"})}}})},delAllTask:function(){var a=this;vq.common.confirm({content:"确定要删除吗?",ok:function(){a.block();var e=$("#project_id").val();var t=$("#version").val();var o=$("#server_id").val();var c=$("#task-status .active").attr("data-status");$.ajax({url:"/task/task/delAll",type:"post",dataType:"json",data:{project_id:e,version:t,server_id:o,status:c},success:function(e){a.unblock();if(e.code==0){reloadDatatable(false)}else{vq.common.error({content:e.msg})}},error:function(){a.unblock()}})}})}};